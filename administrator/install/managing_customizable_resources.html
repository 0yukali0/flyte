

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuring customizable resources &mdash; Flyte 0.5.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Configure Flyte backend" href="configure/index.html" />
    <link rel="prev" title="Optional Components" href="optional_components.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Flyte
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Flyte Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User docs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administrator Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Installing Flyte</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="production.html">Handling Production Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="multi_cluster.html">Scaling Beyond Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="optional_components.html">Optional Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="optional_components.html#data-catalog">Data Catalog</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Configuring customizable resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configurable-resource-types">Configurable Resource Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hierarchy">Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configure/index.html">Configure Flyte backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="authentication.html">Authentication</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor/index.html">Contributor Docs</a></li>
</ul>
<p class="caption"><span class="caption-text">Flyte User cookbook and examples (Github)</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/lyft/flytesnacks/blob/master/README.md">FlyteSnacks - Examples &amp; Cookbook</a></li>
</ul>
<p class="caption"><span class="caption-text">Generated Documentation from Source</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../flyteidl/index.html">Flyte Language and API specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flytekit/index.html">Flytekit</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/flytepropeller">FlytePropeller</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/flyteadmin">FlyteAdmin</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/flyteplugins">FlytePlugins</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/datacatalog">DataCatalog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Flyte</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Administrator Docs</a> &raquo;</li>
        
          <li><a href="index.html">Installing Flyte</a> &raquo;</li>
        
      <li>Configuring customizable resources</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/administrator/install/managing_customizable_resources.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuring-customizable-resources">
<span id="managing-customizable-resources"></span><h1>Configuring customizable resources<a class="headerlink" href="#configuring-customizable-resources" title="Permalink to this headline">¶</a></h1>
<p>As the complexity of your user base grows, you may find yourself tweaking resource assignments based on specific projects, domains and workflows. This document walks through how and in what ways you can configure your Flyte deployment.</p>
<div class="section" id="configurable-resource-types">
<h2>Configurable Resource Types<a class="headerlink" href="#configurable-resource-types" title="Permalink to this headline">¶</a></h2>
<p>Flyte allows these custom settings along the following combination of dimensions</p>
<ul class="simple">
<li><p>domain</p></li>
<li><p>project and domain</p></li>
<li><p>project, domain, and name (must be either a workflow name or a launch plan name)</p></li>
</ul>
<p>Please see the <span class="xref std std-ref">concepts</span> document for more information on projects and domains. Along these dimensions, the following settings are configurable. Note that not all three of the combinations above are valid for each of these settings.</p>
<ul class="simple">
<li><p>Defaults for task resource requests and limits (when not specified by the author of the task).</p></li>
<li><p>Settings for the cluster resource configuration that feeds into Admin’s cluster resource manager.</p></li>
<li><p>Execution queues that are used for Dynamic Tasks. Read more about execution queues here, but effectively they’re meant to be used with constructs like AWS Batch.</p></li>
<li><p>Determining how workflow executions get assigned to clusters in a multi-cluster Flyte deployment.</p></li>
</ul>
<p>The proto definition is the definitive source of which
<a class="reference external" href="https://github.com/lyft/flyteidl/blob/master/protos/flyteidl/admin/matchable_resource.proto">matchable attributes</a>
can be customized.</p>
<p>Each of the four above settings are discussed below.  Also, since the flyte-cli tool does not yet hit these endpoints, we are including some sample <code class="docutils literal notranslate"><span class="pre">curl</span></code> commands for administrators to reference.</p>
<div class="section" id="task-resources">
<h3>Task Resources<a class="headerlink" href="#task-resources" title="Permalink to this headline">¶</a></h3>
<p>This includes setting default value for task resource requests and limits for the following resources:</p>
<ul class="simple">
<li><p>cpu</p></li>
<li><p>gpu</p></li>
<li><p>memory</p></li>
<li><p>storage</p></li>
</ul>
<p>In the absence of an override the global
<a class="reference external" href="https://github.com/lyft/flyteadmin/blob/6a64f00315f8ffeb0472ae96cbc2031b338c5840/flyteadmin_config.yaml#L124,L134">default values</a>
in the flyteadmin config are used.</p>
<p>The override values from the database are assigned at execution time.</p>
</div>
<div class="section" id="cluster-resources">
<h3>Cluster Resources<a class="headerlink" href="#cluster-resources" title="Permalink to this headline">¶</a></h3>
<p>These are free-form key-value pairs which are used when filling in the templates that Admin feeds into its cluster manager. The keys represent templatized variables in <a class="reference external" href="https://github.com/lyft/flyteadmin/tree/master/sampleresourcetemplates">clusterresource template yaml</a> and the values are what you want to see filled in.</p>
<p>In the absence of custom override values, templateData from the <a class="reference external" href="https://github.com/lyft/flyteadmin/blob/6a64f00315f8ffeb0472ae96cbc2031b338c5840/flyteadmin_config.yaml#L154,L159">flyteadmin config</a> is used as a default.</p>
<p>Note that these settings can only take on domain, or a project and domain specificity. Since Flyte has not tied in the notion of a workflow or a launch plan to any Kubernetes constructs, specifying a workflow or launch plan name doesn’t make any sense.</p>
<div class="section" id="command">
<h4>Command<a class="headerlink" href="#command" title="Permalink to this headline">¶</a></h4>
<p>Running the following, will make it so that when Admin fills in cluster resource templates, the K8s namespace <code class="docutils literal notranslate"><span class="pre">projectname-staging</span></code> will have a resource quota of 1000 CPU cores and 5TB of memory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl --request PUT &#39;https://flyte.company.net/api/v1/project_domain_attributes/projectname/staging&#39; --header &#39;Content-Type: application/json&#39; --data-raw &#39;{&quot;attributes&quot;:{&quot;matchingAttributes&quot;:{&quot;clusterResourceAttributes&quot;:{&quot;attributes&quot;:{&quot;projectQuotaCpu&quot;: &quot;1000&quot;, &quot;projectQuotaMemory&quot;: &quot;5000Gi&quot;}}}}}&#39;</span>
</pre></div>
</div>
<p>These values will in turn be used to fill in the template fields in the file at <code class="docutils literal notranslate"><span class="pre">kustomize/overlays/sandbox/admindeployment/clusterresource-templates/ab_project-resource-quota.yaml</span></code> from the base of this repository for the <code class="docutils literal notranslate"><span class="pre">projectname-staging</span></code> namespace and that namespace only. For other namespaces, the defaults at the bottom of <a class="reference external" href="https://github.com/lyft/flyteadmin/blob/6a64f00315f8ffeb0472ae96cbc2031b338c5840/flyteadmin_config.yaml#L152">this file</a> would still be applied.</p>
</div>
</div>
<div class="section" id="execution-queues">
<h3>Execution Queues<a class="headerlink" href="#execution-queues" title="Permalink to this headline">¶</a></h3>
<p>Execution queues are use to determine where dynamic tasks run.</p>
<p>Execution queues themselves are currently defined in the
<a class="reference external" href="https://github.com/lyft/flyteadmin/blob/6a64f00315f8ffeb0472ae96cbc2031b338c5840/flyteadmin_config.yaml#L97,L106">flyteadmin config</a>.</p>
<p>The <strong>attributes</strong> associated with an execution queue must match the <strong>tags</strong> for workflow executions. The tags are associated with configurable resources
stored in the Admin database.</p>
<div class="section" id="id1">
<h4>Command<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl --request PUT &#39;https://flyte.company.net/api/v1/workflow_attributes/project/domain/YourWorkflowName&#39; --header &#39;Content-Type: application/json&#39; --data-raw &#39;{&quot;attributes&quot;:{&quot;matchingAttributes&quot;:{&quot;executionQueueAttributes&quot;:{&quot;tags&quot;:[&quot;my_queue&quot;]}}}}&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="execution-cluster-label">
<h3>Execution Cluster Label<a class="headerlink" href="#execution-cluster-label" title="Permalink to this headline">¶</a></h3>
<p>This allows forcing a matching execution to always execute on a specific kubernetes cluster.</p>
</div>
</div>
<div class="section" id="hierarchy">
<h2>Hierarchy<a class="headerlink" href="#hierarchy" title="Permalink to this headline">¶</a></h2>
<p>Increasing specifity defines how matchable resource attributes get applied. The available configurations, in order of decreasing specifity are:</p>
<ol class="arabic simple">
<li><p>Domain, project, workflow name and launch plan.</p></li>
<li><p>Domain, project and workflow name</p></li>
<li><p>Domain and project</p></li>
<li><p>Domain</p></li>
</ol>
<p>Default values for all and per-domain attributes may be specified in the flyteadmin config as documented above.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Let’s say that our database includes the following</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 23%" />
<col style="width: 17%" />
<col style="width: 22%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Domain</p></th>
<th class="head"><p>Project</p></th>
<th class="head"><p>Workflow</p></th>
<th class="head"><p>Launch Plan</p></th>
<th class="head"><p>Tags</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>production</p></td>
<td><p>widgetmodels</p></td>
<td></td>
<td></td>
<td><p>critical</p></td>
</tr>
<tr class="row-odd"><td><p>production</p></td>
<td><p>widgetmodels</p></td>
<td><p>Demand</p></td>
<td></td>
<td><p>supply</p></td>
</tr>
</tbody>
</table>
<p>Any inbound CreateExecution requests with <strong>[Domain: Production, Project: widgetmodels, Workflow: Demand]</strong> for any launch plan would have a tag value of “supply”.
Any inbound CreateExecution requests with <strong>[Domain: Production, Project: widgetmodels]</strong> for any workflow other than Demand and for any launch plan would have a tag value of “critical”.</p>
<p>All other inbound CreateExecution requests would use the default values specified in the flyteadmin config (if any).</p>
</div>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Use the <a class="reference external" href="https://github.com/lyft/flyteidl/blob/ba13965bcfbf7e7bfce40664800aaf1f2a1088a1/protos/flyteidl/service/admin.proto#L395">get</a> endpoint
to see if overrides exist for a specific resource.</p>
<p>E.g. <a class="reference external" href="https://example.com/api/v1/project_domain_attributes/widgetmodels/production?resource_type=2">https://example.com/api/v1/project_domain_attributes/widgetmodels/production?resource_type=2</a></p>
<p>To get the global state of the world, use the list all endpoint, e.g. <a class="reference external" href="https://example.com/api/v1/matchable_attributes?resource_type=2">https://example.com/api/v1/matchable_attributes?resource_type=2</a>.</p>
<p>The resource type enum (int) is defined in the <a class="reference external" href="https://github.com/lyft/flyteidl/blob/ba13965bcfbf7e7bfce40664800aaf1f2a1088a1/protos/flyteidl/admin/matchable_resource.proto#L8,L20">proto</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configure/index.html" class="btn btn-neutral float-right" title="Configure Flyte backend" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="optional_components.html" class="btn btn-neutral float-left" title="Optional Components" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Flyte Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>