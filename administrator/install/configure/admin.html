

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FlyteAdmin Configuration &mdash; Flyte 0.9.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Authentication" href="../authentication.html" />
    <link rel="prev" title="Plugin Configuration" href="plugins.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/flyte_lockup_on_dark.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Flyte Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User docs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Administrator Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../architecture.html">Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Installing Flyte</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../production.html">Handling Production Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multi_cluster.html">Scaling Beyond Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optional_components.html">Optional Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optional_components.html#data-catalog">Data Catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../managing_customizable_resources.html">Configuring customizable resources</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Configure Flyte backend</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="common.html">Common configuration across all backend components</a></li>
<li class="toctree-l4"><a class="reference internal" href="propeller.html">Propeller Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html">Plugin Configuration</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">FlyteAdmin Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../authentication.html">Authentication</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributor/index.html">Contributor Docs</a></li>
</ul>
<p class="caption"><span class="caption-text">Flyte User cookbook and examples (Github)</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/lyft/flytesnacks/blob/master/README.md">FlyteSnacks - Examples &amp; Cookbook</a></li>
</ul>
<p class="caption"><span class="caption-text">Generated Documentation from Source</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../flytekit/index.html">Flytekit Python</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/spotify/flytekit-java">Flytekit JAVA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../flyteidl/index.html">Flyte Language and API specification</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/flytepropeller">FlytePropeller</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/flyteadmin">FlyteAdmin</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/flyteplugins">FlytePlugins</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/mod/github.com/lyft/datacatalog">DataCatalog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Flyte</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Administrator Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Installing Flyte</a> &raquo;</li>
        
          <li><a href="index.html">Configure Flyte backend</a> &raquo;</li>
        
      <li>FlyteAdmin Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/administrator/install/configure/admin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="flyteadmin-configuration">
<span id="config-admin"></span><h1>FlyteAdmin Configuration<a class="headerlink" href="#flyteadmin-configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-scheduled-workflows">
<h2>Setting up scheduled workflows<a class="headerlink" href="#setting-up-scheduled-workflows" title="Permalink to this headline">¶</a></h2>
<p>In order to run workflow executions based on user-specified schedules you’ll need to fill out the top-level <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> portion of the flyteadmin application configuration.</p>
<p>In particular you’ll need to configure the two components responsible for scheduling workflows and processing schedule event triggers.</p>
<p>Note this functionality is currently only supported for AWS installs.</p>
<div class="section" id="event-scheduler">
<h3>Event Scheduler<a class="headerlink" href="#event-scheduler" title="Permalink to this headline">¶</a></h3>
<p>In order to schedule workflow executions, you’ll need to set up an <a class="reference external" href="https://aws.amazon.com/sqs/">AWS SQS</a> queue. A standard type queue should suffice. The flyteadmin event scheduler creates <a class="reference external" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/Create-CloudWatch-Events-Scheduled-Rule.html">AWS CloudWatch</a> event rules that invokes your SQS queue as a target.</p>
<p>With that in mind, let’s take a look at an example <code class="docutils literal notranslate"><span class="pre">eventScheduler</span></code> config section and dive into what each value represents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scheduler</span><span class="p">:</span>
  <span class="n">eventScheduler</span><span class="p">:</span>
    <span class="n">scheme</span><span class="p">:</span> <span class="s2">&quot;aws&quot;</span>
    <span class="n">region</span><span class="p">:</span> <span class="s2">&quot;us-east-1&quot;</span>
    <span class="n">scheduleRole</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::{{ YOUR ACCOUNT ID }}:role/{{ ROLE }}&quot;</span>
    <span class="n">targetName</span><span class="p">:</span> <span class="s2">&quot;arn:aws:sqs:us-east-1:{{ YOUR ACCOUNT ID }}:{{ YOUR QUEUE NAME }}&quot;</span>
    <span class="n">scheduleNamePrefix</span><span class="p">:</span> <span class="s2">&quot;flyte&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>scheme</strong>: in this case because AWS is the only cloud back-end supported for scheduling workflows, only <code class="docutils literal notranslate"><span class="pre">&quot;aws&quot;</span></code> is a valid value. By default, the no-op scheduler is used.</p></li>
<li><p><strong>region</strong>: this specifies which region initialized AWS clients should will use when creating CloudWatch rules</p></li>
<li><dl class="simple">
<dt><strong>scheduleRole</strong> This is the IAM role ARN with permissions set to <code class="docutils literal notranslate"><span class="pre">Allow</span></code></dt><dd><ul>
<li><p>‘events:PutRule’</p></li>
<li><p>‘events:PutTargets’</p></li>
<li><p>‘events:DeleteRule’</p></li>
<li><p>‘events:RemoveTargets’</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>targetName</strong> this is the ARN for the SQS Queue you’ve allocated to scheduling workflows</p></li>
<li><p><strong>scheduleNamePrefix</strong> this is an entirely optional prefix used when creating schedule rules. Because of AWS naming length restrictions, scheduled rules are a random hash and having a shared prefix makes these names more readable and indicates who generated the rules</p></li>
</ul>
</div>
<div class="section" id="workflow-executor">
<h3>Workflow Executor<a class="headerlink" href="#workflow-executor" title="Permalink to this headline">¶</a></h3>
<p>Scheduled events which trigger need to be handled by the workflow executor, which subscribes to triggered events from the SQS queue you’ve configured above.</p>
<p>Again, let’s break down a sample config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scheduler</span><span class="p">:</span>
  <span class="n">eventScheduler</span><span class="p">:</span>
    <span class="o">...</span>
  <span class="n">workflowExecutor</span><span class="p">:</span>
    <span class="n">scheme</span><span class="p">:</span> <span class="s2">&quot;aws&quot;</span>
    <span class="n">region</span><span class="p">:</span> <span class="s2">&quot;us-east-1&quot;</span>
    <span class="n">scheduleQueueName</span><span class="p">:</span> <span class="s2">&quot;{{ YOUR QUEUE NAME }}&quot;</span>
    <span class="n">accountId</span><span class="p">:</span> <span class="s2">&quot;{{ YOUR ACCOUNT ID }}&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>scheme</strong>: in this case because AWS is the only cloud back-end supported for executing scheduled workflows, only <code class="docutils literal notranslate"><span class="pre">&quot;aws&quot;</span></code> is a valid value. By default, the no-op executor is used.</p></li>
<li><p><strong>region</strong>: this specifies which region AWS clients should will use when creating an SQS subscriber client</p></li>
<li><p><strong>scheduleQueueName</strong>: this is the name of the SQS Queue you’ve allocated to scheduling workflows</p></li>
<li><p><strong>accountId</strong>: Your AWS <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/console_account-alias.html#FindingYourAWSId">account id</a></p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Failure to configure a workflow executor will result in all your scheduled events piling up silently without ever kicking off workflow executions.</p>
</div>
</div>
</div>
<div class="section" id="setting-up-workflow-notifications">
<h2>Setting up workflow notifications<a class="headerlink" href="#setting-up-workflow-notifications" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">notifications</span></code> top-level portion of the flyteadmin config specifies how to handle notifications.</p>
<p>As like in schedules, the notifications handling is composed of two parts. One handles enqueuing notifications asynchronously and the second part handles processing pending notifications and actually firing off emails and alerts.</p>
<p>This is only supported for Flyte instances running on AWS.</p>
<div class="section" id="config">
<h3>Config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h3>
<p>To publish notifications, you’ll need to set up an <a class="reference external" href="https://aws.amazon.com/sns/?whats-new-cards.sort-by=item.additionalFields.postDateTime&amp;whats-new-cards.sort-order=desc">SNS topic</a>.</p>
<p>In order to process notifications, you’ll need to set up an <a class="reference external" href="https://aws.amazon.com/sqs/">AWS SQS</a> queue to consume notification events. This queue must be configured as a subscription to your SNS topic you created above.</p>
<p>In order to actually publish notifications, you’ll need a <a class="reference external" href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-addresses-and-domains.html">verified SES email address</a> which will be used to send notification emails and alerts using email APIs.</p>
<p>The role you use to run flyteadmin must have permissions to read and write to your SNS topic and SQS queue.</p>
<p>Let’s look at the following config section and go into what each value represents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">notifications</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;aws&quot;</span>
  <span class="n">region</span><span class="p">:</span> <span class="s2">&quot;us-east-1&quot;</span>
  <span class="n">publisher</span><span class="p">:</span>
    <span class="n">topicName</span><span class="p">:</span> <span class="s2">&quot;arn:aws:sns:us-east-1:{{ YOUR ACCOUNT ID }}:{{ YOUR TOPIC }}&quot;</span>
  <span class="n">processor</span><span class="p">:</span>
    <span class="n">queueName</span><span class="p">:</span> <span class="s2">&quot;{{ YOUR QUEUE NAME }}&quot;</span>
    <span class="n">accountId</span><span class="p">:</span> <span class="s2">&quot;{{ YOUR ACCOUNT ID }}&quot;</span>
  <span class="n">emailer</span><span class="p">:</span>
    <span class="n">subject</span><span class="p">:</span> <span class="s2">&quot;Notice: Execution </span><span class="se">\&quot;</span><span class="s2">{{ workflow.name }}</span><span class="se">\&quot;</span><span class="s2"> has {{ phase }} in </span><span class="se">\&quot;</span><span class="s2">{{ domain }}</span><span class="se">\&quot;</span><span class="s2">.&quot;</span>
    <span class="n">sender</span><span class="p">:</span>  <span class="s2">&quot;flyte-notifications@company.com&quot;</span>
    <span class="n">body</span><span class="p">:</span> <span class="o">&gt;</span>
      <span class="n">Execution</span> \<span class="s2">&quot;{{ workflow.name }} [{{ name }}]</span><span class="se">\&quot;</span><span class="s2"> has {{ phase }} in </span><span class="se">\&quot;</span><span class="s2">{{ domain }}</span><span class="se">\&quot;</span><span class="s2">. View details at</span>
      <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span>\<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">flyte</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">console</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="p">{{</span> <span class="n">project</span> <span class="p">}}</span><span class="o">/</span><span class="n">domains</span><span class="o">/</span><span class="p">{{</span> <span class="n">domain</span> <span class="p">}}</span><span class="o">/</span><span class="n">executions</span><span class="o">/</span><span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span><span class="o">&gt;</span>
      <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">flyte</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">console</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="p">{{</span> <span class="n">project</span> <span class="p">}}</span><span class="o">/</span><span class="n">domains</span><span class="o">/</span><span class="p">{{</span> <span class="n">domain</span> <span class="p">}}</span><span class="o">/</span><span class="n">executions</span><span class="o">/</span><span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;.</span> <span class="p">{{</span> <span class="n">error</span> <span class="p">}}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>type</strong>: in this case because AWS is the only cloud back-end supported for executing scheduled workflows, only <code class="docutils literal notranslate"><span class="pre">&quot;aws&quot;</span></code> is a valid value. By default, the no-op executor is used.</p></li>
<li><p><strong>region</strong>: this specifies which region AWS clients should will use when creating SNS and SQS clients</p></li>
<li><dl class="simple">
<dt><strong>publisher</strong>: This handles pushing notification events to your SNS topic</dt><dd><ul>
<li><p><strong>topicName</strong>: This is the arn of your SNS topic</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>processor</strong>: This handles the recording notification events and enqueueing them to be processed asynchronously</dt><dd><ul>
<li><p><strong>queueName</strong>: This is the name of the SQS queue which will capture pending notification events</p></li>
<li><p><strong>accountId</strong>: Your AWS <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/console_account-alias.html#FindingYourAWSId">account id</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>emailer</strong>: This section encloses config details for sending and formatting emails used as notifications</dt><dd><ul>
<li><p><strong>subject</strong>: Configurable subject line used in notification emails</p></li>
<li><p><strong>sender</strong>: Your verified SES email sender</p></li>
<li><p><strong>body</strong>: Configurable email body used in notifications</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The full set of parameters which can be used for email templating are checked into <a class="reference external" href="https://github.com/lyft/flyteadmin/blob/a84223dab00dfa52d8ba1ed2d057e77b6c6ab6a7/pkg/async/notifications/email.go#L18,L30">code</a>.</p>
</div>
</div>
<div class="section" id="example-config">
<span id="admin-config-example"></span><h2>Example config<a class="headerlink" href="#example-config" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="flyteadmin-remote-cluster-access">
<h2>FlyteAdmin Remote Cluster Access<a class="headerlink" href="#flyteadmin-remote-cluster-access" title="Permalink to this headline">¶</a></h2>
<p>Some deployments of Flyte may choose to run the control plane separate from the data plane. Flyte Admin is designed to create kubernetes resources in one or more Flyte data plane clusters. For Admin to access remote clusters, it needs credentials to each cluster. In kubernetes, scoped service credentials are created by configuring a “Role” resource in a Kubernetes cluster. When you attach that role to a “ServiceAccount”, Kubernetes generates a bearer token that permits access. We create a flyteadmin <a class="reference external" href="https://github.com/lyft/flyte/blob/c0339e7cc4550a9b7eb78d6fb4fc3884d65ea945/artifacts/base/adminserviceaccount/adminserviceaccount.yaml">ServiceAccount</a> in each data plane cluster to generate these tokens.</p>
<p>When you first create the Flyte Admin ServiceAccount in a new cluster, a bearer token is generated, and will continue to allow access unless the ServiceAccount is deleted. Once we create the Flyte Admin ServiceAccount on a cluster, we should never delete it. In order to feed the credentials to Flyte Admin, you must retrieve them from your new data plane cluster, and upload them to Admin somehow (within Lyft, we use Confidant for example).</p>
<p>The credentials have two parts (ca cert, bearer token). Find the generated secret via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">secrets</span> <span class="o">-</span><span class="n">n</span> <span class="n">flyte</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">flyteadmin</span><span class="o">-</span><span class="n">token</span>
</pre></div>
</div>
<p>Once you have the name of the secret, you can copy the ca cert to your clipboard with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">secret</span> <span class="o">-</span><span class="n">n</span> <span class="n">flyte</span> <span class="p">{</span><span class="n">secret</span><span class="o">-</span><span class="n">name</span><span class="p">}</span> <span class="o">-</span><span class="n">o</span> <span class="n">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ca\.crt}&#39;</span> <span class="o">|</span> <span class="n">base64</span> <span class="o">-</span><span class="n">D</span> <span class="o">|</span> <span class="n">pbcopy</span>
</pre></div>
</div>
<p>You can copy the bearer token to your clipboard with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">secret</span> <span class="o">-</span><span class="n">n</span> <span class="n">flyte</span> <span class="p">{</span><span class="n">secret</span><span class="o">-</span><span class="n">name</span><span class="p">}</span> <span class="o">-</span><span class="n">o</span> <span class="n">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.token}’ | base64 -D | pbcopy</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../authentication.html" class="btn btn-neutral float-right" title="Authentication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plugins.html" class="btn btn-neutral float-left" title="Plugin Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Flyte Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>