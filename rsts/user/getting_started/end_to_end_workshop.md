Workshop docs
=============

Welcome to Flyte 101 workshop. After completing this workshop, you will be able to:
- Start a completely new Flyte Project & Repo
- Add new and Modify existing tasks and workflows
- Write hive, python and sagemaker tasks
- Register and launch tasks and workflows
- Access the outputs generated by workflows in Mode

> **NOTE**
>
>[Official Documentation](https://docs.lyft.net/eng/flyte/index.html) is your friend. Please consult with it before posting questions to [#flyte](https://join.slack.com/share/zt-ilb4zzrb-ZU5aOiQgJBLYXwrv21G_sg)

-------------------------------
## Step 1 Install flytekit

Flytekit is the python SDK you will use to write and interact with flyte. It includes a few tools to help you build, test, register and run your workflows and tasks.

To start, itâ€™s recommended that you create a python virtual environment. Then install flytekit into it.

<details>
  <summary>Click to show the solution!</summary>

  ```
  mkvirtualenv --python=python3 flyte-101
  pip install flytekit
  flyte-cli setup-config -h flyte.lyft.net
  ```
</details>

------------------------------

## Step 2 Create a project

Flyte projects are logical units to help you organize your tasks and workflows. A single repo can have multiple projects and many repos can contribute to the same project.

The typical setup we have seen is that people create a single project per repo.

```flyte-cli``` is the user-facing command line tool that comes with flytekit to interact with the flyte system.

Create a _personal_ project (e.g. john-flyte-workshop).

<details>
  <summary>Click to show the solution!</summary>

  ```
  flyte-cli register-project --name "Haytham's Workshop" --identifier haytham-workshop-101
  ```
</details>

-----------------------------

## Step 3 Clone Playground repo

A typical setup for a new flyte project involves creating a new repo (using metaservice) and applying the flyteworkflow yeoman generator.

Find the [full guidance exist here](https://docs.lyft.net/eng/flyte/flyte2/user/getting_started_at_lyft/setting_up.html).

For the purposes of this workshop, we will clone github.com/lyft/flyteplayground since it's already setup with everything you need.
Go ahead and clone that repo! and while you are at it, rename [this](https://github.com/lyft/flyteplayground/blob/4f6133e996e42c8c7a429993d9f225af7d59d57a/Makefile#L65) and [this](https://github.com/lyft/flyteplayground/blob/4f6133e996e42c8c7a429993d9f225af7d59d57a/Makefile#L10) to the name of the project you created above.

<details>
  <summary>Click to show the solution!</summary>

  ```
  git clone git@github.com:lyft/flyteplayground
  cd flyteplayground
  ```
</details>

-----------------------------

## Step 4 Make sure it works!

At this point your repo is ready to be used. To double check things are working fine. You can create a PR with the changes you just made and monitor the PR Checks to make sure everything is green.

<details>
  <summary>Click to show the solution!</summary>

  ```
  git checkout -b "my-branch-101"
  git add -A
  git commit -m "My first Flyte Workflow"
  git push
  echo "Visit the URL in the logs to create the PR. Do not merge it."
  ```
</details>

-----------------------------

## Step 5 Launch an existing Task/Workflow from the UI

After all PR checks succeed, your workflows should be registered into your project.
If you visit the main [flyte console](https://flyte.lyft.net/console) and search for your project, you should see all registered workflows and tasks under the appropriate tab.

Go ahead and click on `workflows.simple_workflow.SimpleWorkflow` and click `Launch` on the top right corner.

-----------------------------

## Step 6 Train a model on Flyte!

Flyte is an orchestration platform. It has the capability to schedule and run a magnitude of compute tasks (from simple Python tasks, to native mapping tasks to external services like Hive, Presto, SageMaker and many more).

For this exercise, you will leverage the ability to run Hive queries and SageMaker's built-in XGBoost Training tasks. You will then run batch predict on the generated model using a subset of the data you acquired.

The goal of the model is to predict the number of rides per hour for a given time period.


### Task 1
Checkout branch `workshop-task` of `flyteplayground` repo to get the materials needed for the exercise.

<details>
  <summary>Solution</summary>

  Navigate to the directory where you cloned `flyteplayground` repo.

  ```
  git checkout workshop-task
  ```
</details>

### Task 2
Using your favorite IDE, navigate to `workflows/workshop.py` to view the workflow we will be filling in.

In that file, we've written out a skeleton of the workflow we will be writing. And some helper functions you might need.

Navigate around and start filling in the commented blocks.

<details>
  <summary>Complete Solution</summary>

  https://github.com/lyft/flyteplayground/blob/3e300321a26aff87da2be1f0fa5407e7dbb5bb65/workflows/workshop.py
</details>
